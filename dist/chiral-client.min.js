class ChiralUtils{static debounce(t,e,i=!1){let r;return function(...a){const n=i&&!r;clearTimeout(r),r=setTimeout(()=>{r=null,i||t.apply(this,a)},e),n&&t.apply(this,a)}}static throttle(t,e){let i,r;return function(...a){r?(clearTimeout(i),i=setTimeout(()=>{Date.now()-r>=e&&(t.apply(this,a),r=Date.now())},e-(Date.now()-r))):(t.apply(this,a),r=Date.now())}}static deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>ChiralUtils.deepClone(t));if("object"==typeof t){const e={};for(const i in t)t.hasOwnProperty(i)&&(e[i]=ChiralUtils.deepClone(t[i]));return e}return t}static isEmpty(t){return null==t||("string"==typeof t?""===t.trim():Array.isArray(t)?0===t.length:"object"==typeof t&&0===Object.keys(t).length)}static randomString(t=8,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let i="";for(let r=0;r<t;r++)i+=e.charAt(Math.floor(Math.random()*e.length));return i}static formatDate(t,e="en-US"){if(!t)return"";const i=t instanceof Date?t:new Date(t);return isNaN(i.getTime())?"":i.toLocaleDateString(e,{year:"numeric",month:"short",day:"numeric"})}static truncateText(t,e=100,i="..."){return t&&"string"==typeof t?t.length<=e?t:t.substring(0,e-i.length)+i:""}static extractDomain(t){try{return new URL(t).hostname}catch(t){return""}}static isValidUrl(t){try{return new URL(t),!0}catch(t){return!1}}static parseQueryString(t){const e={},i=t.startsWith("?")?t.slice(1):t;if(!i)return e;const r=i.split("&");for(const t of r){const[i,r]=t.split("=");i&&(e[decodeURIComponent(i)]=r?decodeURIComponent(r):"")}return e}static objectToQueryString(t){const e=[];for(const i in t)t.hasOwnProperty(i)&&null!==t[i]&&void 0!==t[i]&&e.push(`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`);return e.join("&")}static getCurrentPageUrl(){return"undefined"!=typeof window&&window.location?window.location.href:""}static log(t,e="info",i=null){(new Date).toISOString(),e.toUpperCase();e.toLowerCase()}static getUserAgent(){if("undefined"==typeof navigator)return{browser:"unknown",version:"unknown",platform:"unknown"};const t=navigator.userAgent;let e="unknown",i="unknown";if(t.indexOf("Chrome")>-1){e="Chrome";const r=t.match(/Chrome\/([0-9.]+)/);r&&(i=r[1])}else if(t.indexOf("Firefox")>-1){e="Firefox";const r=t.match(/Firefox\/([0-9.]+)/);r&&(i=r[1])}else if(t.indexOf("Safari")>-1){e="Safari";const r=t.match(/Version\/([0-9.]+)/);r&&(i=r[1])}else if(t.indexOf("Edge")>-1){e="Edge";const r=t.match(/Edge\/([0-9.]+)/);r&&(i=r[1])}return{browser:e,version:i,platform:navigator.platform||"unknown",userAgent:t}}static ready(t){"undefined"!=typeof document&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}static simpleHash(t){let e=0;if(!t||0===t.length)return e.toString();for(let i=0;i<t.length;i++){e=(e<<5)-e+t.charCodeAt(i),e&=e}return Math.abs(e).toString(36)}static isLocalStorageAvailable(){try{const t="__chiral_test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch(t){return!1}}static getViewportSize(){return"undefined"==typeof window?{width:0,height:0}:{width:window.innerWidth||document.documentElement.clientWidth||0,height:window.innerHeight||document.documentElement.clientHeight||0}}}"undefined"!=typeof module&&module.exports?module.exports=ChiralUtils:"undefined"!=typeof window&&(window.ChiralUtils=ChiralUtils);class ChiralCache{constructor(t="chiral_static"){this.prefix=t,this.isAvailable=this.checkLocalStorageAvailability(),this.isAvailable}checkLocalStorageAvailability(){try{const t="__chiral_cache_test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch(t){return!1}}getCacheKey(t){return`${this.prefix}_${t}`}set(t,e,i=3600){if(!this.isAvailable)return!1;try{const r={data:e,timestamp:Date.now(),ttl:1e3*i},a=this.getCacheKey(t);return localStorage.setItem(a,JSON.stringify(r)),!0}catch(t){return!1}}get(t){if(!this.isAvailable)return null;try{const e=this.getCacheKey(t),i=localStorage.getItem(e);if(!i)return null;const r=JSON.parse(i);return Date.now()-r.timestamp>r.ttl?(this.remove(t),null):r.data}catch(t){return null}}remove(t){if(!this.isAvailable)return!1;try{const e=this.getCacheKey(t);return localStorage.removeItem(e),!0}catch(t){return!1}}clear(){if(!this.isAvailable)return 0;let t=0;const e=[];try{for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);i&&i.startsWith(this.prefix+"_")&&e.push(i)}return e.forEach(e=>{localStorage.removeItem(e),t++}),t}catch(e){return t}}cleanExpired(){if(!this.isAvailable)return 0;let t=0;const e=[],i=Date.now();try{for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);i&&i.startsWith(this.prefix+"_")&&e.push(i)}return e.forEach(e=>{try{const r=localStorage.getItem(e);if(r){const a=JSON.parse(r);i-a.timestamp>a.ttl&&(localStorage.removeItem(e),t++)}}catch(i){localStorage.removeItem(e),t++}}),t}catch(e){return t}}getStats(){if(!this.isAvailable)return{available:!1,totalItems:0,totalSize:0,expiredItems:0};let t=0,e=0,i=0;const r=Date.now();try{for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n&&n.startsWith(this.prefix+"_")){t++;const a=localStorage.getItem(n);if(a){e+=a.length;try{const t=JSON.parse(a);r-t.timestamp>t.ttl&&i++}catch(t){i++}}}}}catch(t){}return{available:!0,totalItems:t,totalSize:e,expiredItems:i}}static generateRelatedPostsKey(t,e,i){const r=`${t}|${e}|${i}`;return`related_posts_${ChiralCache.simpleHash(r)}`}static simpleHash(t){let e=0;if(0===t.length)return e.toString();for(let i=0;i<t.length;i++){e=(e<<5)-e+t.charCodeAt(i),e&=e}return Math.abs(e).toString(36)}}"undefined"!=typeof module&&module.exports?module.exports=ChiralCache:"undefined"!=typeof window&&(window.ChiralCache=ChiralCache);class ChiralConfig{constructor(t={}){this.config=this.validateAndNormalize(t)}validateAndNormalize(t){const e=this.deepMerge({hubUrl:"",containerId:"chiral-related-posts",display:{count:5,enableCache:!0,cacheTTL:3600,showThumbnails:!0,showExcerpts:!0},i18n:{locale:"en",fallbackLocale:"en",customMessages:{}}},t);if(!e.hubUrl||"string"!=typeof e.hubUrl||""===e.hubUrl.trim())throw new Error("Chiral Static Client: hubUrl is required and cannot be empty");e.hubUrl=e.hubUrl.replace(/\/+$/,"");try{new URL(e.hubUrl)}catch(t){throw new Error("Chiral Static Client: hubUrl must be a valid URL")}return e.display.count=Math.max(1,Math.min(20,parseInt(e.display.count)||5)),e.display.cacheTTL=Math.max(60,parseInt(e.display.cacheTTL)||3600),e.display.enableCache=Boolean(e.display.enableCache),e.display.showThumbnails=Boolean(e.display.showThumbnails),e.display.showExcerpts=Boolean(e.display.showExcerpts),e.i18n.locale=this.normalizeLocale(e.i18n.locale||"en"),e.i18n.fallbackLocale=this.normalizeLocale(e.i18n.fallbackLocale||"en"),e}deepMerge(t,e){const i={...t};for(const t in e)e.hasOwnProperty(t)&&(e[t]&&"object"==typeof e[t]&&!Array.isArray(e[t])?i[t]=this.deepMerge(i[t]||{},e[t]):i[t]=e[t]);return i}normalizeLocale(t){if(!t||"string"!=typeof t)return"en";return{zh:"zh-CN","zh-cn":"zh-CN","zh-tw":"zh-TW","zh-hk":"zh-TW",en:"en","en-us":"en","en-gb":"en",ja:"ja","ja-jp":"ja"}[t.toLowerCase()]||"en"}getHubDomain(){try{return new URL(this.config.hubUrl).hostname}catch(t){return""}}get(t){const e=t.split(".");let i=this.config;for(const t of e){if(!i||"object"!=typeof i||!i.hasOwnProperty(t))return;i=i[t]}return i}getAll(){return{...this.config}}}"undefined"!=typeof module&&module.exports?module.exports=ChiralConfig:"undefined"!=typeof window&&(window.ChiralConfig=ChiralConfig);const CHIRAL_I18N_MESSAGES={en:{loading:"Loading related Chiral data...",relatedTitle:"Related Content",noData:"No related Chiral data found at the moment.",fetchError:"Error fetching related data",configError:"Chiral Connector: Configuration error for related posts.",source:"Source: {0}",fromChiralNetwork:"From Chiral Network: {0}",cptNotFound:"Page data not found in Chiral network",networkError:"Network connection error"},"zh-CN":{loading:"正在加载相关 Chiral 数据...",relatedTitle:"相关内容",noData:"暂时没有找到相关 Chiral 数据。",fetchError:"获取相关数据时出错",configError:"Chiral Connector：相关文章配置错误。",source:"来源：{0}",fromChiralNetwork:"来自 Chiral 网络：{0}",cptNotFound:"在 Chiral 网络中未找到页面数据",networkError:"网络连接错误"},"zh-TW":{loading:"正在載入相關 Chiral 資料...",relatedTitle:"相關內容",noData:"暫時沒有找到相關 Chiral 資料。",fetchError:"獲取相關資料時出錯",configError:"Chiral Connector：相關文章配置錯誤。",source:"來源：{0}",fromChiralNetwork:"來自 Chiral 網路：{0}",cptNotFound:"在 Chiral 網路中未找到頁面資料",networkError:"網路連線錯誤"},ja:{loading:"関連 Chiral データを読み込み中...",relatedTitle:"関連コンテンツ",noData:"関連 Chiral データが見つかりませんでした。",fetchError:"関連データの取得エラー",configError:"Chiral Connector：関連記事の設定エラー。",source:"ソース：{0}",fromChiralNetwork:"Chiral ネットワークから：{0}",cptNotFound:"Chiral ネットワークにページデータが見つかりません",networkError:"ネットワーク接続エラー"}};class ChiralI18n{constructor(t="en",e={}){this.locale=this.normalizeLocale(t),this.fallbackLocale="en",this.messages=this.mergeMessages(CHIRAL_I18N_MESSAGES,e)}setLocale(t){this.locale=this.normalizeLocale(t)}t(t,e=[]){let i=this.getMessage(t,this.locale);return i||this.locale===this.fallbackLocale||(i=this.getMessage(t,this.fallbackLocale)),i?this.interpolate(i,e):t}getMessage(t,e){const i=this.messages[e];return i?t.split(".").reduce((t,e)=>t&&t[e],i):null}interpolate(t,e){return t.replace(/\{(\d+)\}/g,(t,i)=>void 0!==e[i]?e[i]:t)}mergeMessages(t,e){const i=JSON.parse(JSON.stringify(t));return Object.keys(e).forEach(t=>{i[t]||(i[t]={}),Object.assign(i[t],e[t])}),i}normalizeLocale(t){if(!t||"string"!=typeof t)return"en";return{zh:"zh-CN","zh-cn":"zh-CN","zh-tw":"zh-TW","zh-hk":"zh-TW",en:"en","en-us":"en","en-gb":"en",ja:"ja","ja-jp":"ja"}[t.toLowerCase()]||"en"}static getConfiguredLocale(t){return t.i18n?.locale||"en"}getAvailableLocales(){return Object.keys(this.messages)}isLocaleSupported(t){return this.messages.hasOwnProperty(this.normalizeLocale(t))}}"undefined"!=typeof module&&module.exports?module.exports={ChiralI18n:ChiralI18n,CHIRAL_I18N_MESSAGES:CHIRAL_I18N_MESSAGES}:"undefined"!=typeof window&&(window.ChiralI18n=ChiralI18n,window.CHIRAL_I18N_MESSAGES=CHIRAL_I18N_MESSAGES);class ChiralAPI{constructor(t){if(this.hubUrl=t?t.replace(/\/+$/,""):"",this.hubDomain=this.extractDomain(this.hubUrl),!this.hubUrl)throw new Error("Chiral API: hubUrl is required")}extractDomain(t){try{return new URL(t).hostname}catch(t){return""}}async findCptId(t){if(!t||!this.hubDomain)throw new Error("Chiral API: Missing currentPageUrl or hubDomain");const e=`https://public-api.wordpress.com/rest/v1.1/sites/${encodeURIComponent(this.hubDomain)}/posts`,i=new URLSearchParams({type:"chiral_data",meta_key:"chiral_source_url",meta_value:t,_fields:"ID",number:1});try{const t=await fetch(`${e}?${i}`,{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`WordPress API error: ${t.status} ${t.statusText}`);const r=await t.json();return r.posts&&Array.isArray(r.posts)&&r.posts.length>0?r.posts[0].ID:null}catch(t){throw new Error(`Failed to find page data in Chiral network: ${t.message}`)}}async getRelatedPostIdsFromHub(t,e=5){try{const i=`${this.hubUrl}/wp-json/chiral-network/v1/related-post-ids`,r=new URLSearchParams({cpt_id:t.toString(),count:e.toString()}),a=await fetch(`${i}?${r}`,{method:"GET",headers:{Accept:"application/json"}});if(!a.ok){if(404===a.status)return[];throw 403===a.status?new Error("Domain not authorized in Chiral network"):429===a.status?new Error("Rate limit exceeded. Please try again later."):new Error(`HTTP ${a.status}: ${a.statusText}`)}return(await a.json()).related_post_ids||[]}catch(t){throw t}}async getPostDetailsFromWpApi(t,e){const i=`https://public-api.wordpress.com/rest/v1.1/sites/${encodeURIComponent(t)}/posts/${e}`,r=new URLSearchParams({fields:"ID,title,URL,excerpt,date,featured_image,tags,categories,author,metadata"});try{const t=await fetch(`${i}?${r}`,{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`WordPress API error: ${t.status} ${t.statusText}`);const e=await t.json();if(e&&e.ID)return e;throw new Error("Invalid post data received")}catch(t){throw new Error(`Failed to fetch post details: ${t.message}`)}}async getRelatedPosts(t,e=5){try{const i=await this.findCptId(t);if(!i)throw new Error("Page data not found in Chiral network");const r=await this.getRelatedPostIdsFromHub(i,e);if(!r||0===r.length)return[];const a=r.map(async t=>{try{const e=await this.getPostDetailsFromWpApi(this.hubDomain,t);return this.normalizePostData(e)}catch(t){return null}});return(await Promise.all(a)).filter(t=>null!==t).slice(0,e)}catch(t){throw t}}normalizePostData(t){let e=t.URL||"#";if(t.metadata&&Array.isArray(t.metadata)){const i=t.metadata.find(t=>"chiral_source_url"===t.key);i&&i.value&&(e=i.value)}return{id:t.ID,title:t.title||"Untitled",url:e,excerpt:t.excerpt?this.stripHtmlTags(t.excerpt):"",featured_image_url:t.featured_image||null,date:t.date||null,author_name:t.author?.name||"N/A",metadata:t.metadata||[],network_name:this.extractNetworkName()}}extractNetworkName(){try{return new URL(this.hubUrl).hostname||"Chiral Network"}catch(t){return"Chiral Network"}}stripHtmlTags(t){if(!t||"string"!=typeof t)return"";const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}async testConnection(){try{const t=`${this.hubUrl}/wp-json/chiral-network/v1/related-post-ids`,e=new URLSearchParams({cpt_id:"1",count:"1"});return 0!==(await fetch(`${t}?${e}`,{method:"GET",headers:{Accept:"application/json"}})).status}catch(t){return!1}}}"undefined"!=typeof module&&module.exports?module.exports=ChiralAPI:"undefined"!=typeof window&&(window.ChiralAPI=ChiralAPI);class ChiralDisplay{constructor(t){if(!t)throw new Error("Chiral Display: Configuration is required");this.config=new ChiralConfig(t),this.api=new ChiralAPI(this.config.get("hubUrl"),this.config.get("nodeId")),this.cache=new ChiralCache("chiral_static"),this.initI18n()}initI18n(){const t=ChiralI18n.getConfiguredLocale(this.config.getAll()),e=ChiralI18n.prototype.normalizeLocale(t),i=this.config.get("i18n.customMessages")||{};this.i18n=new ChiralI18n(e,i)}async init(){const t=["#chiral-connector-related-posts","#chiral-related-posts"],e=this.config.get("containerId");e&&t.unshift(`#${e}`);let i=[];for(const e of t){const t=document.querySelectorAll(e);i=i.concat(Array.from(t))}if(0!==i.length)for(const t of i)try{await this.loadAndRenderRelatedPosts(t)}catch(e){this.renderErrorState(t,e)}}async loadAndRenderRelatedPosts(t){const e=t.dataset.postUrl||window.location.href,i=t.dataset.hubUrl||this.config.get("hubUrl"),r=parseInt(t.dataset.count)||this.config.get("display.count");if(!e||!i)throw new Error(this.i18n.t("configError"));this.renderLoadingState(t);try{let a=null;const n=this.config.get("display.enableCache");if(n){const n=ChiralCache.generateRelatedPostsKey(e,i,r);if(a=this.cache.get(n),a)return void this.renderRelatedPosts(t,a,i)}if(a=await this.api.getRelatedPosts(e,r),n&&a){const t=ChiralCache.generateRelatedPostsKey(e,i,r),n=this.config.get("display.cacheTTL");this.cache.set(t,a,n)}a&&a.length>0?this.renderRelatedPosts(t,a,i):this.renderNoDataState(t,i)}catch(e){e.message.includes("Page data not found")?this.renderCptNotFoundState(t,i):this.renderErrorState(t,e)}}renderLoadingState(t){t.innerHTML=`<p class="chiral-loading">${this.i18n.t("loading")}</p>`}renderNoDataState(t,e){const i=this.generateSubtitleHtml(e,null),r=`\n            <div class="chiral-connector-related-posts-list">\n                <h3>${this.i18n.t("relatedTitle")}</h3>\n                ${i}\n                <p class="chiral-no-related-posts">${this.i18n.t("noData")}</p>\n            </div>\n        `;t.innerHTML=r}renderCptNotFoundState(t,e){const i=this.generateSubtitleHtml(e,null),r=`\n            <div class="chiral-connector-related-posts-list">\n                <h3>${this.i18n.t("relatedTitle")}</h3>\n                ${i}\n                <p class="chiral-no-related-posts">${this.i18n.t("cptNotFound")}</p>\n            </div>\n        `;t.innerHTML=r}renderErrorState(t,e){const i=`${this.i18n.t("fetchError")}: ${e.message}`,r=`\n            <div class="chiral-connector-related-posts-list">\n                <h3>${this.i18n.t("relatedTitle")}</h3>\n                <p class="chiral-no-related-posts">${this.escapeHtml(i)}</p>\n            </div>\n        `;t.innerHTML=r}renderRelatedPosts(t,e,i){const r=this.generateSubtitleHtml(i,e[0]);let a=`\n            <div class="chiral-connector-related-posts-list">\n                <h3>${this.i18n.t("relatedTitle")}</h3>\n                ${r}\n                <ul>\n        `;e.forEach(t=>{a+=this.renderRelatedPostItem(t,i)}),a+="\n                </ul>\n            </div>\n        ",t.innerHTML=a}renderRelatedPostItem(t,e){const i=this.config.get("display.showThumbnails"),r=this.config.get("display.showExcerpts");let a="<li>";const n=t.url||"#";i&&t.featured_image_url&&(a+=`\n                <div class="related-post-thumbnail">\n                    <a href="${this.escapeHtml(n)}" target="_blank" rel="noopener noreferrer">\n                        <img src="${this.escapeHtml(t.featured_image_url)}" alt="${this.escapeHtml(t.title)}">\n                    </a>\n                </div>\n            `),a+='<div class="related-post-content">',a+=`<h4><a href="${this.escapeHtml(n)}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(t.title)}</a></h4>`,r&&t.excerpt&&(a+=`<div class="related-post-excerpt">${this.escapeHtml(t.excerpt)}</div>`);const o=this.generateSourceLabel(t,e);return o&&(a+=`<small class="related-post-source">${o}</small>`),a+="</div>",a+="</li>",a}generateSourceLabel(t,e){const i=e&&t.url&&0===t.url.indexOf(e)&&t.url.indexOf("/chiral_data/")>-1;if(t.author_name&&"N/A"!==t.author_name)return this.i18n.t("source",[this.escapeHtml(t.author_name)]);if(i)try{const t=new URL(e).hostname;return this.i18n.t("source",[this.escapeHtml(t)+" (Hub)"])}catch(t){return this.i18n.t("source",["Chiral Hub"])}else if(t.url&&"#"!==t.url)try{const e=new URL(t.url).hostname;return this.i18n.t("source",[this.escapeHtml(e)])}catch(t){return""}return""}generateSubtitleHtml(t,e){let i="Chiral Network",r=t;if(e&&e.network_name)i=e.network_name;else if(t)try{i=new URL(t).hostname}catch(t){i="Chiral Network"}return r&&""!==r.trim()?`<small class="chiral-hub-name-subtitle">${this.i18n.t("fromChiralNetwork",[`<a href="${this.escapeHtml(r)}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(i)}</a>`])}</small>`:`<small class="chiral-hub-name-subtitle">${this.i18n.t("fromChiralNetwork",[this.escapeHtml(i)])}</small>`}escapeHtml(t){if("string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}}"undefined"!=typeof module&&module.exports?module.exports=ChiralDisplay:"undefined"!=typeof window&&(window.ChiralDisplay=ChiralDisplay),function(t){"use strict";class ChiralClient{constructor(t={}){this.version="1.0.0",this.isInitialized=!1;try{this.config=new ChiralConfig(t),this.initializeModules(),ChiralUtils.log("Chiral Static Client initialized","info",{version:this.version,config:this.config.getAll()}),this.isInitialized=!0}catch(t){throw ChiralUtils.log("Failed to initialize Chiral Static Client","error",t),t}}initializeModules(){this.api=new ChiralAPI(this.config.get("hubUrl")),this.cache=new ChiralCache("chiral_static"),this.display=new ChiralDisplay(this.config.getAll());const t=ChiralI18n.getConfiguredLocale(this.config.getAll()),e=this.config.get("i18n.customMessages")||{};this.i18n=new ChiralI18n(t,e)}async start(){if(!this.isInitialized)throw new Error("Chiral Client: Not initialized");try{ChiralUtils.log("Starting Chiral Static Client display","info"),await this.display.init()}catch(t){throw ChiralUtils.log("Failed to start Chiral Static Client","error",t),t}}async testConnection(){if(!this.isInitialized)throw new Error("Chiral Client: Not initialized");try{return await this.api.testConnection()}catch(t){return ChiralUtils.log("Connection test failed","error",t),!1}}async getRelatedPosts(t,e){if(!this.isInitialized)throw new Error("Chiral Client: Not initialized");try{return await this.api.getRelatedPosts(t,e)}catch(t){throw ChiralUtils.log("Failed to get related posts","error",t),t}}clearCache(){if(!this.isInitialized)throw new Error("Chiral Client: Not initialized");return this.cache.clear()}getCacheStats(){if(!this.isInitialized)throw new Error("Chiral Client: Not initialized");return this.cache.getStats()}getInfo(){return{version:this.version,initialized:this.isInitialized,config:this.isInitialized?this.config.getAll():null,userAgent:ChiralUtils.getUserAgent(),viewport:ChiralUtils.getViewportSize()}}}function e(e){try{const i=new ChiralClient(e);return t.chiralClientInstance=i,ChiralUtils.ready(async()=>{try{await i.start()}catch(t){ChiralUtils.log("Auto-start failed","error",t)}}),i}catch(t){throw ChiralUtils.log("Failed to initialize client","error",t),t}}t.ChiralClient={Client:ChiralClient,init:e,Config:ChiralConfig,API:ChiralAPI,Display:ChiralDisplay,Cache:ChiralCache,I18n:ChiralI18n,Utils:ChiralUtils,version:"1.0.0"},t.chiralClient={init:e,version:"1.0.0"};const i=document.currentScript;function r(){if(ChiralUtils.log("performAutoInitialization called","info"),ChiralUtils.log("Checking for window.ChiralConfig","info",{exists:void 0!==t.ChiralConfig,value:t.ChiralConfig,isFunction:"function"==typeof t.ChiralConfig,isObject:"object"==typeof t.ChiralConfig}),void 0!==t.ChiralConfig&&"object"==typeof t.ChiralConfig&&null!==t.ChiralConfig&&"function"!=typeof t.ChiralConfig)try{ChiralUtils.log("Auto-initializing from window.ChiralConfig","info"),e(t.ChiralConfig)}catch(t){ChiralUtils.log("Auto-initialization failed","error",t)}else{ChiralUtils.log("Checking for data attributes auto-init","info");let t=null;if(ChiralUtils.log("Checking captured script","info",{currentExecutingScript:i,hasAutoInit:i?i.getAttribute("data-auto-init"):null}),i&&"true"===i.getAttribute("data-auto-init")&&(t=i,ChiralUtils.log("Found captured script with auto-init","info")),!t){const e=document.querySelectorAll('script[data-auto-init="true"]');e.length>0&&(t=e[0],ChiralUtils.log("Found script via querySelector","info"))}if(t){const i=t.getAttribute("data-hub-url"),r=t.getAttribute("data-node-id"),a=t.getAttribute("data-container")||"chiral-related-posts",n=parseInt(t.getAttribute("data-count"))||5;if(ChiralUtils.log("Script element found","info",t),ChiralUtils.log("Raw attributes","info",{"data-hub-url":t.getAttribute("data-hub-url"),"data-node-id":t.getAttribute("data-node-id"),"data-container":t.getAttribute("data-container"),"data-count":t.getAttribute("data-count")}),ChiralUtils.log("Processed values","info",{hubUrl:i,nodeId:r,container:a,count:n}),i&&r)try{ChiralUtils.log("Auto-initializing from data attributes","info",{hubUrl:i,nodeId:r,container:a,count:n});const t={hubUrl:i,nodeId:r,containerId:a,display:{count:n,enableCache:!0,cacheTTL:3600,showThumbnails:!0,showExcerpts:!0}};ChiralUtils.log("Config object created","info",t),e(t),ChiralUtils.log("Auto-initialization completed successfully","info")}catch(t){ChiralUtils.log("Data attribute initialization failed","error",t);const e=document.getElementById(a);e&&t.message.includes("required")&&(e.innerHTML='<p class="chiral-no-related-posts">Chiral Client configuration error. Please check your settings.</p>')}else{ChiralUtils.log("Missing required data attributes (data-hub-url, data-node-id)","warn");const e=document.getElementById(a);e&&"true"===t.getAttribute("data-auto-init")&&(e.innerHTML='<p class="chiral-no-related-posts">Missing required configuration: data-hub-url and data-node-id are required.</p>')}}else ChiralUtils.log("No global ChiralConfig or data-auto-init script found, skipping auto-initialization","warn")}}ChiralUtils.log("Captured currentScript","info",i),ChiralUtils.log("Executing auto-initialization immediately","info"),r(),ChiralUtils.ready(()=>{ChiralUtils.log("DOM ready, executing auto-initialization again","info"),r()}),ChiralUtils.log("Chiral Static Client library loaded","info",{version:"1.0.0",timestamp:(new Date).toISOString()})}(window);